<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>L&K Scanner</title>
    <style>
        body { background: #121212; color: white; font-family: sans-serif; text-align: center; padding: 20px; }
        .box { max-width: 400px; margin: auto; background: #1e1e1e; padding: 20px; border-radius: 15px; border: 1px solid #333; shadow: 0 4px 10px rgba(0,0,0,0.5); }
        input { width: 90%; padding: 12px; margin: 10px 0; border-radius: 8px; border: none; background: #333; color: white; }
        button { width: 95%; padding: 12px; background: #ffcc00; border: none; font-weight: bold; cursor: pointer; border-radius: 8px; color: black; }
        .res { margin-top: 20px; text-align: left; }
        .item { background: #2a2a2a; padding: 12px; margin: 8px 0; border-radius: 8px; border-left: 4px solid #ffcc00; }
        a { color: #00ccff; text-decoration: none; font-weight: bold; font-family: monospace; }
        #status { font-size: 0.8em; margin-bottom: 10px; }
    </style>
</head>
<body>

<div class="box">
    <h2>Scanner 327</h2>
    <div id="status">Caricamento dati...</div>
    
    <input type="text" id="link" placeholder="Incolla link profilo">
    <button onclick="cerca()">CERCA GIOCATORE</button>

    <div id="risultati" class="res"></div>
</div>

<script>
let database = [];

async function inizializza() {
    const status = document.getElementById('status');
    try {
        // Indirizzo corretto verso lk_tool
        const url = 'https://re-panza.github.io/lk_tool/mondo327.json?nocache=' + Math.random();
        const resp = await fetch(url);
        if (!resp.ok) throw new Error();
        database = await resp.json();
        status.innerHTML = "‚úÖ Database Pronto (" + database.length + " castelli)";
        status.style.color = "#4caf50";
    } catch (e) {
        status.innerHTML = "‚ùå Errore: File non trovato in lk_tool";
        status.style.color = "#f44336";
    }
}

inizializza();

function cerca() {
    const input = document.getElementById('link').value;
    const resDiv = document.getElementById('risultati');
    
    const match = input.match(/player\?(\d+)/);
    if (!match) {
        resDiv.innerHTML = "<p style='color:orange;'>‚ö†Ô∏è Incolla un link valido!</p>";
        return;
    }

    const idCercato = parseInt(match[1]);
    const trovati = database.filter(c => c.p === idCercato);

    if (trovati.length === 0) {
        resDiv.innerHTML = "Nessun castello per ID: " + idCercato;
        return;
    }

    let html = "<b>Trovati: " + trovati.length + "</b><br>";
    trovati.forEach(c => {
        const linkLK = "l+k://coordinate?" + c.x + "&" + c.y + "&327";
        html += '<div class="item">' + c.n + '<br><a href="' + linkLK + '">üìç ' + c.x + ':' + c.y + '</a></div>';
    });
    
    resDiv.innerHTML = html;
    document.getElementById('link').value = ""; 
}
</script>

</body>
</html>
