<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>L&K Scanner 327</title>
    <style>
        body { background: #121212; color: white; font-family: sans-serif; text-align: center; padding: 20px; }
        .box { max-width: 400px; margin: auto; background: #1e1e1e; padding: 20px; border-radius: 10px; border: 1px solid #333; }
        input { width: 90%; padding: 10px; margin: 10px 0; border-radius: 5px; border: none; }
        button { width: 94%; padding: 10px; background: #ffcc00; border: none; font-weight: bold; cursor: pointer; border-radius: 5px; }
        .res { margin-top: 20px; text-align: left; }
        .item { background: #2a2a2a; padding: 10px; margin: 5px 0; border-radius: 5px; border-left: 4px solid #ffcc00; }
        a { color: #00ccff; text-decoration: none; font-weight: bold; }
    </style>
</head>
<body>

<div class="box">
    <h2>Scanner 327</h2>
    <div id="status" style="font-size: 0.8em; color: #888;">Caricamento database...</div>
    
    <input type="text" id="link" placeholder="Incolla link giocatore qui">
    <button onclick="cerca()">CERCA</button>

    <div id="risultati" class="res"></div>
</div>

<script>
let database = [];

// Funzione che scarica il file JSON
async function inizializza() {
    const status = document.getElementById('status');
    try {
        const url = 'https://re-panza.github.io/lk_tool/mondo327.json?v=' + Date.now();
        const resp = await fetch(url);
        if (!resp.ok) throw new Error();
        database = await resp.json();
        status.innerHTML = "‚úÖ Database Pronto: " + database.length + " castelli";
    } catch (e) {
        status.innerHTML = "‚ùå Errore: File mondo327.json non trovato";
    }
}

inizializza();

function cerca() {
    const input = document.getElementById('link').value;
    const resDiv = document.getElementById('risultati');
    
    // Estrae l'ID dal link
    const match = input.match(/player\?(\d+)/);
    if (!match) {
        resDiv.innerHTML = "‚ö†Ô∏è Link non valido!";
        return;
    }

    const id = parseInt(match[1]);
    const trovati = database.filter(c => c.p === id);

    if (trovati.length === 0) {
        resDiv.innerHTML = "Nessun castello per l'ID " + id;
        return;
    }

    let html = "<b>Trovati: " + trovati.length + "</b><br><br>";
    trovati.forEach(c => {
        const link = "l+k://coordinate?" + c.x + "&" + c.y + "&327";
        html += '<div class="item">' + c.n + '<br><a href="' + link + '">üìç ' + c.x + ':' + c.y + '</a></div>';
    });
    
    resDiv.innerHTML = html;
}
</script>

</body>
</html>
